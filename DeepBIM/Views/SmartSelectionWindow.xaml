<Window x:Class="DeepBIM.Views.SmartSelectionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:localConverters="clr-namespace:DeepBIM.Converters"
        mc:Ignorable="d"
        Title="DeepBIM - Smart Selection"
        Height="885"
        Width="1075"
        MinWidth="800"
        MinHeight="600"
        ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="CenterScreen"
        >

    <!-- ===== THEME ===== -->
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Resources/Styles/Styles.xaml"/>
                <ResourceDictionary Source="../Resources/Styles/ComboboxStyle.xaml"/>
                <ResourceDictionary Source="../Resources/Styles/TextBlockStyle.xaml"/>
                <ResourceDictionary Source="../Resources/Styles/DataGridStyle.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- Resources -->
            <sys:Double x:Key="ElementSpacing">12</sys:Double>
            <Thickness x:Key="FieldMargin">0,0,0,12</Thickness>
            <Thickness x:Key="GroupMargin">0,0,12,20</Thickness>
            <Duration x:Key="AnimationDuration">0:00:0.2</Duration>
            <Color x:Key="HoverColor">#42A5F5</Color>
            <Color x:Key="SelectedColor">#1976D2</Color>
            <Color x:Key="AccentColor">#0288D1</Color>
            <!-- Boolean to Visibility Converter -->
            <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
            <localConverters:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
            
        </ResourceDictionary>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ===== HEADER ===== -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <!-- Title and Icon -->
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <Path Data="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M17,13h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"
                      Fill="{DynamicResource Accent}"
                      Width="28" Height="28" Margin="0,0,12,0"/>
                <TextBlock Text="Smart Selection"
                           Style="{StaticResource TextHeader}"
                           FontSize="22"
                           FontWeight="Bold"
                           VerticalAlignment="Center"/>
            </StackPanel>
            <!-- Presets -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                <ComboBox Width="200"
                          Style="{StaticResource {x:Type ComboBox}}"
                          ToolTip="Load or save selection presets"
                          SelectedIndex="0"
                          Margin="0,0,12,0">
                    <ComboBoxItem>Load Preset...</ComboBoxItem>
                    <ComboBoxItem>Recent Selection</ComboBoxItem>
                    <ComboBoxItem>Structural Components</ComboBoxItem>
                    <ComboBoxItem>MEP Elements</ComboBoxItem>
                </ComboBox>
                <Button Content="Save Preset"
                        Style="{StaticResource SecondaryButton}"
                        Width="100"
                        Click="SavePreset_Click"/>
            </StackPanel>
        </Grid>

        <!-- ===== MAIN CONTENT ===== -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.5*"/>
                <ColumnDefinition Width="2.5*"/>
            </Grid.ColumnDefinitions>

            <!-- === LEFT COLUMN: Categories === -->
            <Border Grid.RowSpan="1" Style="{StaticResource Card}" Margin="0 0 12 0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Style="{StaticResource HeaderBar}">
                        <TextBlock Text="All Categories" Foreground="White" FontWeight="SemiBold"/>
                    </Border>

                    <TextBox Grid.Row="1" 
         Style="{StaticResource WatermarkTextBox}"
         Tag="🔎  Search Category. Press Enter to apply search."
         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
         Margin="0,10,0,8">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <Border Grid.Row="2" BorderBrush="{StaticResource CardBorder}" BorderThickness="1" CornerRadius="6" Padding="6">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Select all -->
                            <CheckBox Content=" - Select all Categories - "
                          IsChecked="{Binding SelectAll, Mode=TwoWay}"
                          Margin="6 0 0 8"/>

                            <!-- List populated from ViewModel -->
                            <ListBox Grid.Row="1"
                         ItemsSource="{Binding CategoryView}"
                         BorderThickness="0">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <DockPanel>
                                            <CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}" Margin="6 0"/>
                                            <TextBlock Text="{Binding Display}" VerticalAlignment="Center" Margin="6 0"/>
                                        </DockPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </Border>
                </Grid>
            </Border>









            <!-- === RIGHT COLUMN: Filters & Options === -->
            <StackPanel Grid.Column="1">
                <!-- Selection Scope -->
                <GroupBox Header="Selection Scope"
                      Style="{StaticResource ModernGroupBox}"
                      Margin="{StaticResource GroupMargin}">
                            <StackPanel Margin="0,12,0,12">
                                <RadioButton Content="Current View"
                                 IsChecked="{Binding SelectionScope, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=CurrentView}"
                                 Margin="0,0,0,8"
                                 ToolTip="Select elements in the active view only"/>
                                <RadioButton Content="Entire Project"
                                 IsChecked="{Binding SelectionScope, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=EntireProject}"
                                 Margin="0,0,0,8"
                                 ToolTip="Select elements across the entire project"/>
                                <RadioButton Content="Selected Views"
                                 IsChecked="{Binding SelectionScope, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=SelectedViews}"
                                 Margin="0,0,0,8"
                                 ToolTip="Select elements in specific views"/>
                            </StackPanel>   
                </GroupBox>

                <!-- Filter by Properties -->
                <GroupBox Header="Filter by Properties"
                          Style="{StaticResource ModernGroupBox}"
                          Margin="{StaticResource GroupMargin}">
                    <StackPanel Margin="0,12,0,12" x:Name="FilterPanel">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8">
                            <TextBlock Text="Level:" Width="90" Style="{StaticResource TextSubHeader}"/>
                            <ComboBox x:Name="LevelComboBox"
                                      Style="{StaticResource {x:Type ComboBox}}"
                                      Width="200"
                                      SelectedIndex="0"
                                      SelectionChanged="LevelComboBox_SelectionChanged">
                                <ComboBoxItem>All Levels</ComboBoxItem>
                                <ComboBoxItem>Level 1</ComboBoxItem>
                                <ComboBoxItem>Level 2</ComboBoxItem>
                                <ComboBoxItem>Level 3</ComboBoxItem>
                            </ComboBox>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8">
                            <TextBlock Text="Type:" Width="90" Style="{StaticResource TextSubHeader}"/>
                            <ComboBox x:Name="TypeComboBox"
                                      Style="{StaticResource {x:Type ComboBox}}"
                                      Width="200"
                                      SelectedIndex="0">
                                <ComboBoxItem>All Types</ComboBoxItem>
                                <ComboBoxItem>Type A</ComboBoxItem>
                                <ComboBoxItem>Type B</ComboBoxItem>
                            </ComboBox>
                        </StackPanel>
                        <Button Content="Add Property Filter"
                                Style="{StaticResource SecondaryButton}"
                                Width="140"
                                HorizontalAlignment="Left"
                                Click="AddPropertyFilter_Click"/>
                    </StackPanel>
                </GroupBox>

                <!-- Advanced Options -->
                <GroupBox Header="Advanced Options"
                          Style="{StaticResource ModernGroupBox}"
                          Margin="{StaticResource GroupMargin}">
                    <StackPanel Margin="0,12,0,12">
                        <CheckBox Content="Include Elements from Linked Models"
                                  Margin="0,0,0,8"
                                  ToolTip="Include elements from externally linked models"/>
                        <CheckBox Content="Select Only Isolated Elements"
                                  Margin="0,0,0,8"
                                  ToolTip="Select elements not attached to others"/>
                        <CheckBox Content="Highlight Selection in 3D View"
                                  IsChecked="True"
                                  Margin="0,0,0,8"
                                  ToolTip="Highlight selected elements in the active 3D view"/>
                        <CheckBox Content="Auto-Zoom to Selection"
                                  Margin="0,0,0,8"
                                  ToolTip="Automatically zoom to selected elements in the view"/>
                    </StackPanel>
                </GroupBox>

                <!-- Preview -->
                <Border Background="{DynamicResource AccentLight}"
                        BorderBrush="{DynamicResource Accent}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12"
                        Margin="{StaticResource GroupMargin}">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                        <TextBlock Text="🔍 Preview:"
                                   FontWeight="SemiBold"
                                   Margin="0,0,8,0"/>
                        <TextBlock x:Name="PreviewCountText"
                                   Text="{Binding SelectedElementsCount, StringFormat={}{0} elements will be selected}"
                                   Foreground="{DynamicResource Accent}"
                                   FontWeight="SemiBold"
                                   Margin="0,0,12,0"/>
                        <ProgressBar x:Name="SelectionProgress"
                                     Width="100"
                                     Height="6"
                                     Value="{Binding SelectionProgressValue}"
                                     Maximum="100"
                                     Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisConverter}}"
                                     Margin="0,0,12,0"/>
                        <Button Content="Refresh"
                                Style="{StaticResource SecondaryButton}"
                                Width="90"
                                Click="RefreshPreview_Click"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- ===== CONTROL BUTTONS ===== -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,24,0,0">
            <Button Content="Cancel"
                    Style="{StaticResource CancelButton}"
                    Width="120"
                    Margin="0,0,12,0"
                    Click="CancelButton_Click"/>
            <Button Content="Apply"
                    Style="{StaticResource OkButton}"
                    Width="120"
                    Click="ApplyButton_Click">
                <Button.Triggers>
                    <EventTrigger RoutedEvent="Button.Click">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                To="0.7" Duration="{StaticResource AnimationDuration}"
                                                AutoReverse="True"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Button.Triggers>
            </Button>
        </StackPanel>
    </Grid>
</Window>